<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fenêtres avec Importation XLS et Firebase</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/skin-win7/ui.fancytree.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/jquery.fancytree-all-deps.min.js"></script>
    <style>
        .split { display: flex; height: 100vh; }
        .left, .right { padding: 10px; overflow-y: auto; }
        .left { width: 50%; border-right: 1px solid #ddd; }
        .right { width: 50%; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { border: 1px solid #ddd; padding: 8px; }
        .draggable { cursor: move; }
    </style>
</head>
<body>
    <div class="split">
        <div class="left">
            <h2>Importation XLS</h2>
            <input type="file" id="importExcel" accept=".xlsx">
            <table id="fancytreeTable" class="table"></table>
        </div>
        <div class="right">
            <h2>Contenu de la Fenêtre de Droite</h2>
            <!-- Fenêtre de droite pour des interactions supplémentaires -->
        </div>
    </div>

    <script>
        // Initialisation Firebase
        var firebaseConfig = {
              apiKey: "AIzaSyBFEt617ywvSB1dqoca95idSEMILMNHo3Q",

  authDomain: "pacautov2.firebaseapp.com",

  databaseURL: "https://pacautov2-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "pacautov2",

  storageBucket: "pacautov2.appspot.com",

  messagingSenderId: "307082937084",

  appId: "1:307082937084:web:06ab27ea5da0ac0e454d79"

        };
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        document.getElementById('importExcel').addEventListener('change', function(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                generateFancyTreeFromExcel(sheet);
            };
            reader.readAsArrayBuffer(event.target.files[0]);
        });

        function generateFancyTreeFromExcel(data) {
            let treeData = [];

            data.forEach((row, index) => {
                if (index === 0) return; // Skip header

                let newNode = {
                    title: row[1], // Colonne 2 (index 1)
                    tooltip: row[6], // Colonne 7 pour le tooltip
                    folder: false,
                    data: {
                        column1: row[0],  // Colonne 1
                        column3: row[2],  // Colonne 3
                        column6: row[5],  // Colonne 6
                        column8: row[7],  // Colonne 8
                        column9: row[8],  // Colonne 9
                        column11: row[10], // Colonne 11
                        column12: row[11], // Colonne 12
                        column13: row[12], // Colonne 13
                        column14: row[13], // Colonne 14
                        column15: row[14], // Colonne 15
                        column16: row[15], // Colonne 16
                        column17: row[16], // Colonne 17
                        column18: row[17]  // Colonne 18
                    },
                    extraClasses: "draggable"
                };
                treeData.push(newNode);
            });

            $("#fancytreeTable").fancytree({
                extensions: ["table"],
                table: {
                    indentation: 20,
                    nodeColumnIdx: 0,
                    checkboxColumnIdx: 0,
                    titleColumnIdx: 1
                },
                source: treeData,
                renderColumns: function(event, data) {
                    var node = data.node,
                        $tdList = $(node.tr).find(">td");

                    // Render title (column 3 with tooltip)
                    $tdList.eq(0).text(node.title).attr("title", node.tooltip);

                    // Render other columns
                    $tdList.eq(1).text(node.data.column1);
                    $tdList.eq(2).text(node.data.column3);
                    $tdList.eq(3).text(node.data.column6);
                    // Add more columns as needed...

                    // Add "Compteur" column
                    $tdList.eq(-1).html("<span class='compteur'>0</span>");
                },
                activate: function(event, data) {
                    // Sauvegarder dans Firebase quand un élément est activé
                    var nodeData = data.node.data;
                    database.ref('fancytree/' + data.node.key).set(nodeData);
                },
                draggable: {
                    // FancyTree drag & drop configuration
                    autoExpand: true,
                    preventVoidMoves: true,
                    dragStart: function(node, data) {
                        return true;
                    },
                    dragEnter: function(node, data) {
                        return true;
                    },
                    dragDrop: function(node, data) {
                        data.otherNode.moveTo(node, data.hitMode);
                    }
                }
            });
        }
    </script>
</body>
</html>







