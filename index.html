<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FancyTree avec Firebase et Importation XLS</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/skin-lion/ui.fancytree.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/jquery.fancytree-all-deps.min.js"></script>
    <style>
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { border: 1px solid #ddd; padding: 8px; }
        .draggable { cursor: move; }
    </style>
</head>
<body>
    <h2>Importation XLS avec Firebase et FancyTree</h2>
    <input type="file" id="importExcel" accept=".xlsx">
    <table id="fancytreeTable" class="table">
        <thead>
            <tr>
                <th>Key</th>
                <th>Title</th>
                <th>Colonne 1</th>
                <th>Colonne 2</th>
                <th>Compteur</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        // Initialisation de Firebase
        var firebaseConfig = {
              apiKey: "AIzaSyBFEt617ywvSB1dqoca95idSEMILMNHo3Q",

  authDomain: "pacautov2.firebaseapp.com",

  databaseURL: "https://pacautov2-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "pacautov2",

  storageBucket: "pacautov2.appspot.com",

  messagingSenderId: "307082937084",

  appId: "1:307082937084:web:06ab27ea5da0ac0e454d79"

        };
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        // Importation et gestion de l'Excel
        document.getElementById('importExcel').addEventListener('change', function(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                generateFancyTreeFromExcel(sheet);
            };
            reader.readAsArrayBuffer(event.target.files[0]);
        });

        function generateFancyTreeFromExcel(data) {
            let treeData = [];

            data.forEach((row, index) => {
                if (index === 0) return; // Skip header
                let newNode = {
                    title: row[1] || "Titre manquant",  // Colonne 2 du fichier Excel
                    tooltip: row[6] || "Pas de tooltip",  // Colonne 7 pour le tooltip
                    folder: false,
                    data: {
                        column1: row[0] || "N/A",  // Colonne 1
                        column2: row[2] || "N/A",  // Colonne 3
                        column6: row[5] || "N/A",  // Colonne 6
                        column8: row[7] || "N/A",  // Colonne 8
                        column9: row[8] || "N/A",  // Colonne 9
                        column11: row[10] || "N/A", // Colonne 11
                        column12: row[11] || "N/A", // Colonne 12
                        column13: row[12] || "N/A", // Colonne 13
                        column14: row[13] || "N/A", // Colonne 14
                        column15: row[14] || "N/A", // Colonne 15
                        column16: row[15] || "N/A", // Colonne 16
                        column17: row[16] || "N/A", // Colonne 17
                        column18: row[17] || "N/A"  // Colonne 18
                    }
                };
                treeData.push(newNode);
            });

            // Sauvegarde dans Firebase et affichage dans FancyTree
            $("#fancytreeTable").fancytree({
                extensions: ["table", "dnd5"],
                table: {
                    checkboxColumnIdx: 0,
                    indentation: 20,
                    nodeColumnIdx: 1
                },
                source: treeData,
                renderColumns: function(event, data) {
                    var node = data.node,
                        $tdList = $(node.tr).find(">td");

                    $tdList.eq(0).text(node.key);  // Key
                    $tdList.eq(1).text(node.title).attr("title", node.tooltip);  // Title avec tooltip
                    $tdList.eq(2).text(node.data.column1);  // Données colonne 1
                    $tdList.eq(3).text(node.data.column2);  // Données colonne 2
                    $tdList.eq(4).html("<span class='compteur'>0</span>");  // Colonne compteur

                    // Sauvegarde Firebase à chaque activation de nœud
                    firebase.database().ref('fancytree/' + node.key).set(node.data);
                },
                dnd5: {
                    dragStart: function(node, data) { return true; },
                    dragEnter: function(node, data) { return true; },
                    dragDrop: function(node, data) {
                        data.otherNode.moveTo(node, data.hitMode);
                    }
                }
            });
        }
    </script>
</body>
</html>







