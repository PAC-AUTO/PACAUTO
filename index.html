<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FancyTree avec Firebase et Importation XLS</title>
    <!-- jQuery and FancyTree -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/skin-lion/ui.fancytree.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.37.0/dist/jquery.fancytree-all-deps.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js"></script>
    
    <style>
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>
    <h2>FancyTree avec Firebase et Importation XLS</h2>
    <input type="file" id="importExcel" accept=".xlsx">
    <table id="fancytreeTable" class="table">
        <thead>
            <tr>
                <th>Key</th>
                <th>Title</th>
                <th>Colonne 1</th>
                <th>Colonne 2</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBFEt617ywvSB1dqoca95idSEMILMNHo3Q",

  authDomain: "pacautov2.firebaseapp.com",

  databaseURL: "https://pacautov2-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "pacautov2",

  storageBucket: "pacautov2.appspot.com",

  messagingSenderId: "307082937084",

  appId: "1:307082937084:web:06ab27ea5da0ac0e454d79"

        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Fonction pour sauvegarder les données en temps réel dans Firebase
        function saveToFirebase(nodeData) {
            const nodeId = nodeData.key;
            firebase.database().ref('tree/' + nodeId).set(nodeData);
        }

        // Gestion de l'importation du fichier Excel
        document.getElementById('importExcel').addEventListener('change', function(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                generateFancyTreeFromExcel(sheet);
            };
            reader.readAsArrayBuffer(event.target.files[0]);
        });

        // Génération du FancyTree à partir des données Excel
        function generateFancyTreeFromExcel(data) {
            let treeData = [];

            data.forEach((row, index) => {
                if (index === 0) return; // Skip header

                let newNode = {
                    title: row[1] || "Titre manquant",  // Colonne 2 du fichier Excel
                    folder: false,
                    key: index,  // Utilisation de l'index comme clé unique
                    data: {
                        column1: row[0] || "N/A",  // Colonne 1
                        column3: row[2] || "N/A"   // Colonne 3
                    }
                };
                treeData.push(newNode);
                saveToFirebase(newNode);  // Sauvegarder chaque nœud dans Firebase
            });

            // Création de l'arbre avec l'extension table activée
            $("#fancytreeTable").fancytree({
                extensions: ["table"],
                table: {
                    checkboxColumnIdx: 0,  // Add checkboxes to this column index
                    indentation: 20,       // Indentation for tree structure
                    nodeColumnIdx: 1       // Place the expander and node title in this column
                },
                source: treeData,
                renderColumns: function(event, data) {
                    var node = data.node,
                        $tdList = $(node.tr).find(">td");

                    $tdList.eq(0).text(node.key);  // Display node key
                    $tdList.eq(1).text(node.title);  // Display node title
                    $tdList.eq(2).text(node.data.column1);  // Custom data for column 1
                    $tdList.eq(3).text(node.data.column3);  // Custom data for column 3
                },
                modifyChild: function(event, data) {
                    saveToFirebase(data.node.toDict(true));  // Sauvegarder les modifications en temps réel
                }
            });
        }
    </script>
</body>
</html>








