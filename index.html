<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Hiérarchique avec Export HTML (FancyTree)</title>
    <style>
        .fancytree-title {
            font-size: 1.4em; /* Par exemple, pour définir une taille de police de 18 pixels */
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
        }
        .split {
            width: 50%;
            padding: 10px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            width: 5%;
            font-size: 1em;
        }
        .draggable {
            cursor: move;
        }
        .fancytree-container {
            border: 1px solid #ddd;
            margin-top: 10px;
            padding: 10px;
        }
        .highlight {
            background-color: #ffff99;
        }
        .dragged-item {
            font-weight: bold;
        }
        .btn {
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            margin-right: 10px;
        }
        .blue-line {
            background-color: #add8e6;
        }
        .green-counter {
            background-color: #90ee90;
        }
        .green-column {
            background-color: #90ee90;
        }
        .highlight-expanded {
            background-color: #d0f0c0;
        }
        .tooltip-content {
            font-size: 1.4em;
            color: #555;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 2px solid #ccc;
            margin-top: 5px;
            display: none;
            white-space: pre-wrap;
        }
        .show-tooltip {
            display: block;
        }
        .toggle-btn {
            cursor: pointer;
            margin-left: 5px;
            color: blue;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.fancytree/2.38.1/skin-lion/ui.fancytree.min.css">
</head>
<body>
<div class="split left">
    <h2>TRAME TYPE PAC AUTO</h2>
    <input type="file" id="importExcel" accept=".xlsx">
    <button id="exportHtmlTableBtn" class="btn">Exporter Tableau (HTML)</button>
    <button id="importHtmlTableBtn" class="btn">Importer Tableau (HTML)</button>
    <table id="tableData">
        <thead>
            <tr>
                <th>Col 1</th>
                <th>Col 2</th>
                <th>Col 3</th>
                <th>Col 6</th>
                <th>Col 8</th>
                <th>Col 9</th>
                <th>Col 11</th>
                <th>Col 12</th>
                <th>Col 13</th>
                <th>Col 14</th>
                <th>Col 15</th>
                <th>Col 16</th>
                <th>Col 17</th>
                <th>Col 18</th>
                <th>Compteur</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<div class="split right">
    <h2>Trame DOCURBA</h2>
    <input type="file" id="importWord" accept=".docx"><br><br>
    <button id="exportBtn" class="btn">Exporter plan (JSON)</button>
    <button id="importJsonBtn" class="btn">Importer plan (JSON)</button>
    <button id="addNodeBtn" class="btn">Ajouter Sous-répertoire</button>
    <button id="deleteNodeBtn" class="btn" style="background-color: red;">Supprimer répertoire</button>
    <button id="exportHtmlBtn" class="btn">Exporter contenus (HTML)</button>
    <div id="tree" class="fancytree-container"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.fancytree/2.38.1/jquery.fancytree-all-deps.min.js"></script>

<script>
// Configuration Firebase
const firebaseConfig = {
    apiKey: "AIzaSyBFEt617ywvSB1dqoca95idSEMILMNHo3Q",
    authDomain: "pacautov2.firebaseapp.com",
    databaseURL: "https://pacautov2-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "pacautov2",
    storageBucket: "pacautov2.appspot.com",
    messagingSenderId: "307082937084",
    appId: "1:307082937084:web:06ab27ea5da0ac0e454d79"
};

// Initialisation Firebase
const app = firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Sauvegarde automatique des données du tableau dans Firebase
function saveTableDataToFirebase() {
    const rows = document.querySelectorAll("#tableData tbody tr");
    const tableData = [];
    rows.forEach(row => {
        const rowData = Array.from(row.cells).map(cell => cell.textContent);
        tableData.push(rowData);
    });

    firebase.database().ref('tableData').set(tableData);
}

// Sauvegarde automatique des données de FancyTree dans Firebase
function saveTreeDataToFirebase() {
    const tree = $("#tree").fancytree("getTree").toDict(true);
    firebase.database().ref('treeData').set(tree);
}

// Charger les données du tableau à partir de Firebase
function loadTableDataFromFirebase() {
    firebase.database().ref('tableData').once('value', snapshot => {
        const data = snapshot.val();
        if (data) {
            const tableBody = document.querySelector("#tableData tbody");
            tableBody.innerHTML = '';  // Vider l'ancien contenu
            data.forEach(rowData => {
                const row = document.createElement('tr');
                row.innerHTML = rowData.map(cell => `<td>${cell}</td>`).join('');
                tableBody.appendChild(row);
            });
        }
    });
}

// Charger les données de FancyTree à partir de Firebase
function loadTreeDataFromFirebase() {
    firebase.database().ref('treeData').once('value', snapshot => {
        const data = snapshot.val();
        if (data) {
            $("#tree").fancytree("getTree").reload(data);
        }
    });
}

// Sauvegarde en temps réel lorsque des données sont modifiées
document.getElementById('tableData').addEventListener('input', saveTableDataToFirebase);
document.getElementById('tree').addEventListener('change', saveTreeDataToFirebase);

// Initialisation de FancyTree
$(function() {
    $("#tree").fancytree({
        extensions: ["dnd5"],
        source: [], // La source sera chargée à partir de Firebase
        dnd5: {
            preventRecursion: true,
            preventVoidMoves: true,
            dragStart: function(node, data) { return true; },
            dragEnter: function(node, data) { return ["before", "after", "over"]; },
            dragDrop: function(node, data) {
                data.otherNode.moveTo(node, data.hitMode);
                saveTreeDataToFirebase(); // Sauvegarder après un glisser-déposer
            }
        }
    });

    // Charger les données lors du démarrage
    loadTableDataFromFirebase();
    loadTreeDataFromFirebase();
});
</script>
</body>
</html>





